### Dex文件格式总览

Dex文件是Android平台上Java源码文件经编译和处理后得到的字节码文件，为什么Android平台不直接使用Class文件，而是另起炉灶重新实现一种新的文件格式呢？

Android系统主要针对移动设备，而移动设备的内存、存储空间相对PC平台而言较小，并且**主要使用ARM的CPU。这种CPU有一个显著特点，就是通用寄存器比较多。**在这种情况下，Class格式的文件在移动设备上不能扬长避短。介绍invokevirtual指令的时候，我们看到Class文件中指令码执行的时候需要存取操作数栈（operand stack）。而在移动设备上，由于ARM的CPU有很多通用寄存器，Dex中的指令码可以利用它们来存取参数。

显然，寄存器的存取速度比位于内存中的操作数栈的存取速度要快得多。

### Dex和Class文件格式的区别

一个Class文件对应一个Java源码文件，而一个Dex文件可对应多个Java源码文件

在Android平台上，这些Java源码文件的内容最终会编译、合并到一个名为classes.dex的文件中。不过，从编译过程来看，**Java源文件其实会先编译成多个.class文件，然后再由相关工具将它们合并到Jar包或Apk包中的classes.dex文件中**

Dex文件的这种做法有什么好处

1. 虽然Class文件通过索引方式能减少字符串等信息的冗余度，但是多个Class文件之间可能还是有重复字符串等信息。而classes.dex由于包含了多个Class文件的内容，所以可以进一步去除其中的重复信息。
2. 如果一个Class文件依赖另外一个Class文件，则虚拟机在处理的时候需要读取另外一个Class文件的内容，这可能会导致CPU和存储设备进行更多的I/O操作。而classes.dex由于一个文件就包含了所有的信息，相对而言会减少I/O操作的次数。





